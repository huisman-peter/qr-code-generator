import "p-elements-core/dist/p-elements-core-modern.js";
import QRCodeStyling from "qr-code-styling";
import { save } from '@tauri-apps/api/dialog';
import { writeBinaryFile } from '@tauri-apps/api/fs';
import css from "./qr.css?inline";
class PfzwQrCodeGenerator extends CustomElement {
    url = "https://pfzw.nl/";
    render = () => {
        return Maquette.h("div", null,
            Maquette.h("input", { type: "url", value: this.url, oninput: this.onDataChange }),
            Maquette.h("div", { id: "QRContainer", afterCreate: this.onCreateQRElement }),
            Maquette.h("button", { onclick: this.onDownloadButtonClick }, "Download QR code"));
    };
    onCreateQRElement = (n) => {
        this.qrCode = new QRCodeStyling(this.defaultStyling);
        this.qrCode.append(n);
    };
    onDataChange = (e) => {
        const htmlInput = e.target;
        this.url = htmlInput.value;
        this.url = this.defaultStyling.data;
        this.qrCode.update(this.defaultStyling);
    };
    onDownloadButtonClick = async () => {
        const defaultPath = this.url.split("//")[1].replaceAll("/", "-").replaceAll("?", "-").replaceAll(".", "-").replaceAll('/', "-");
        const path = await save({
            filters: [{
                    name: "QR code",
                    // defaultPath: defaultPath,
                    extensions: ['svg']
                }]
        }).catch((e) => e);
        if (path instanceof Error || !path) {
            console.log(path);
            return;
        }
        var type = "application/svg+xml";
        var blob = new Blob([this.qrCode._svg.outerHTML.replace("<svg ", "<svg xmlns=\"http://www.w3.org/2000/svg\" ")], { type });
        const buffer = await blob.arrayBuffer();
        const contents = new Uint8Array(buffer);
        const saveResult = await writeBinaryFile({
            contents,
            path
        });
    };
    defaultStyling;
    qrCode;
    get logo() {
        return "data:image/svg+xml;base64," + btoa(`<svg id="Laag_1" data-name="Laag 1" viewBox="0 0 156 54" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <style>
        .cls-3{fill:#fff}
      </style>
    </defs>
    <g transform="translate(3.055 3)">
      <rect x="8.02" y="14.41" width="141.87" height="33.59" rx="5.7" fill="#12aa74"/>
      <rect width="94.66" height="21.47" rx="5.7" fill="#434b99"/>
      <path class="cls-3" d="M13.7 9.12a2.441 2.441 0 01-.8 2 3.473 3.473 0 01-2.28.68h-.73v2.83H8.21V6.64h2.54a3.368 3.368 0 012.2.62 2.26 2.26 0 01.75 1.86zm-3.81 1.26h.56a1.81 1.81 0 001.16-.31 1.06 1.06 0 00.39-.89 1.1 1.1 0 00-.33-.88 1.49 1.49 0 00-1-.28h-.78zM17.31 14.7a3.14 3.14 0 01-2.31-.82 3.06 3.06 0 01-.83-2.29A3.353 3.353 0 0115 9.23a2.713 2.713 0 012.11-.84 2.69 2.69 0 012 .74 2.8 2.8 0 01.71 2V12h-3.95c-.006.407.144.801.42 1.1a1.46 1.46 0 001.1.4 5.02 5.02 0 001-.11 5.089 5.089 0 001-.37v1.29a4.077 4.077 0 01-.93.32 5.9 5.9 0 01-1.15.07zm-.23-5.13a1 1 0 00-.83.34 1.535 1.535 0 00-.34.95h2.33a1.432 1.432 0 00-.32-.95 1.082 1.082 0 00-.84-.34zM26.58 14.59h-1.66V11a1.68 1.68 0 00-.24-1 .831.831 0 00-.74-.33 1.12 1.12 0 00-1 .46 3.002 3.002 0 00-.31 1.55v2.86H21V8.51h1.27l.22.77h.1c.183-.29.447-.519.76-.66a2.622 2.622 0 011.11-.23A2.118 2.118 0 0126 9c.391.457.589 1.049.55 1.65zM32.51 12.78a1.7 1.7 0 01-.65 1.43 3.243 3.243 0 01-1.94.49 5.942 5.942 0 01-1.13-.09 3.93 3.93 0 01-.88-.27V13c.321.154.656.278 1 .37.327.083.663.13 1 .14.6 0 .9-.17.9-.52a.441.441 0 00-.12-.32 1.883 1.883 0 00-.41-.28c-.19-.1-.46-.22-.78-.36a4.473 4.473 0 01-1-.54 1.593 1.593 0 01-.48-.57 1.943 1.943 0 01-.15-.8 1.429 1.429 0 01.63-1.25 3 3 0 011.78-.45 5.09 5.09 0 012.14.48l-.5 1.2a8.54 8.54 0 00-.86-.32 2.454 2.454 0 00-.81-.13c-.49 0-.73.13-.73.4a.45.45 0 00.23.38c.32.189.654.353 1 .49a4.6 4.6 0 011 .54c.208.147.376.342.49.57.147.226.24.482.27.75zM33.39 6.94c0-.54.3-.81.9-.81.61 0 .91.27.91.81a.812.812 0 01-.23.6.998.998 0 01-.68.21c-.6 0-.9-.27-.9-.81zm1.73 7.65h-1.66V8.51h1.66zM42.21 11.54a3.229 3.229 0 01-.79 2.32 2.821 2.821 0 01-2.18.84 2.998 2.998 0 01-1.54-.39 2.5 2.5 0 01-1-1.1 3.694 3.694 0 01-.36-1.67 3.243 3.243 0 01.78-2.32 2.873 2.873 0 012.19-.83 3.077 3.077 0 011.54.38c.435.259.783.642 1 1.1a3.64 3.64 0 01.36 1.67zm-4.21 0c-.03.473.074.944.3 1.36a1.06 1.06 0 001 .46.999.999 0 00.95-.46 2.59 2.59 0 00.29-1.36 2.57 2.57 0 00-.29-1.36 1.07 1.07 0 00-1-.45 1 1 0 00-1 .45 2.47 2.47 0 00-.25 1.36zM46.32 14.7a3.151 3.151 0 01-2.3-.82 3.06 3.06 0 01-.83-2.29A3.348 3.348 0 0144 9.23a3.08 3.08 0 014.12-.1 2.76 2.76 0 01.71 2V12h-3.96c-.006.407.144.801.42 1.1a1.46 1.46 0 001.1.4 5.02 5.02 0 001-.11 5.089 5.089 0 001-.37v1.29a4.077 4.077 0 01-.93.32 5.804 5.804 0 01-1.14.07zm-.24-5.13a1 1 0 00-.83.34 1.614 1.614 0 00-.34.95h2.33a1.38 1.38 0 00-.32-.95 1.082 1.082 0 00-.84-.34zM55.58 14.59h-1.66V11a1.68 1.68 0 00-.24-1 .831.831 0 00-.74-.33 1.13 1.13 0 00-1 .46 3.002 3.002 0 00-.31 1.55v2.86H50V8.51h1.26l.23.77h.09c.183-.29.447-.519.76-.66a2.622 2.622 0 011.11-.23A2.12 2.12 0 0155 9c.391.457.589 1.049.55 1.65zM60.47 9.75H59v4.84h-1.63V9.75h-.91V9l.91-.44v-.5a1.999 1.999 0 01.51-1.52 2.349 2.349 0 011.64-.47 4.31 4.31 0 011.53.25l-.43 1.22a2.941 2.941 0 00-.92-.16.58.58 0 00-.51.21.849.849 0 00-.16.54v.38h1.44zM66.76 11.54a3.27 3.27 0 01-.76 2.32 2.83 2.83 0 01-2.18.84 2.998 2.998 0 01-1.54-.39 2.5 2.5 0 01-1-1.1 3.694 3.694 0 01-.36-1.67 3.243 3.243 0 01.78-2.32 2.85 2.85 0 012.18-.83 3.117 3.117 0 011.55.38c.433.262.78.644 1 1.1a3.64 3.64 0 01.33 1.67zm-4.2 0c-.03.473.074.944.3 1.36.22.33.607.508 1 .46.395.06.789-.121 1-.46a2.59 2.59 0 00.29-1.36 2.468 2.468 0 00-.3-1.36 1.24 1.24 0 00-1.91 0 2.476 2.476 0 00-.38 1.36zM73.73 14.59h-1.66V11a1.692 1.692 0 00-.23-1 .85.85 0 00-.74-.33 1.12 1.12 0 00-1 .46 2.883 2.883 0 00-.31 1.55v2.86h-1.67V8.51h1.27l.22.77h.09c.187-.29.454-.52.77-.66a2.574 2.574 0 011.1-.23 2.093 2.093 0 011.61.61 2.27 2.27 0 01.55 1.65zM77.19 14.7a2.001 2.001 0 01-1.69-.84 3.862 3.862 0 01-.61-2.3 3.842 3.842 0 01.62-2.33 2 2 0 011.72-.84 1.998 1.998 0 011.77.89 6.147 6.147 0 01-.13-1.21V6.13h1.66v8.46H79.3l-.3-.79h-.07a1.9 1.9 0 01-1.74.9zm.58-1.33c.351.03.695-.107.93-.37a2 2 0 00.3-1.25v-.18a2.49 2.49 0 00-.3-1.4 1.11 1.11 0 00-1-.43 1 1 0 00-.86.47 2.48 2.48 0 00-.31 1.37c-.029.47.079.939.31 1.35.205.307.563.476.93.44zM86.37 12.78a1.68 1.68 0 01-.65 1.43 3.243 3.243 0 01-1.94.49 6.11 6.11 0 01-1.13-.09 4.091 4.091 0 01-.88-.27V13c.321.154.656.278 1 .37.327.083.663.13 1 .14.6 0 .91-.17.91-.52a.441.441 0 00-.12-.32 1.997 1.997 0 00-.42-.28 9.73 9.73 0 00-.78-.36 4.473 4.473 0 01-1-.54 1.593 1.593 0 01-.48-.57 1.943 1.943 0 01-.15-.8 1.429 1.429 0 01.63-1.25 3 3 0 011.78-.45 5.09 5.09 0 012.14.48l-.5 1.2a8.514 8.514 0 00-.78-.35 2.454 2.454 0 00-.81-.13c-.49 0-.73.13-.73.4a.45.45 0 00.23.38c.32.189.654.353 1 .49.355.136.691.318 1 .54.21.144.379.34.49.57.124.242.189.509.19.78zM26.29 38.5h-9.56v-2L22 28.91h-5.15v-2.68h9.3v2l-5.31 7.55h5.45zM36.66 33.73a5.09 5.09 0 01-1.25 3.64 4.661 4.661 0 01-3.52 1.3 4.57 4.57 0 01-3.45-1.33 5.001 5.001 0 01-1.28-3.61 4.999 4.999 0 011.26-3.62 4.688 4.688 0 013.52-1.29 4.999 4.999 0 012.48.6 4.09 4.09 0 011.66 1.71 5.49 5.49 0 01.58 2.6zm-6.16 0a4.149 4.149 0 00.33 1.86c.194.421.627.68 1.09.65.46.029.89-.23 1.08-.65a4.323 4.323 0 00.32-1.86 4.158 4.158 0 00-.32-1.84 1.26 1.26 0 00-2.17 0 3.996 3.996 0 00-.33 1.84zM44 28.82c.275-.003.55.021.82.07H45L44.71 32a4.682 4.682 0 00-1.12-.1 2.101 2.101 0 00-1.56.49c-.35.387-.527.9-.49 1.42v4.69h-3.28V29h2.44l.51 1.52h.16c.274-.497.67-.917 1.15-1.22.437-.3.951-.466 1.48-.48zM55 29v1.59l-1.3.48c.195.341.299.727.3 1.12a2.87 2.87 0 01-1.07 2.38 5.125 5.125 0 01-3.22.85 3.697 3.697 0 01-.84-.07.899.899 0 00-.12.42c0 .16.13.28.39.37.325.094.662.138 1 .13h1.57c2.14 0 3.2.9 3.2 2.69a3.061 3.061 0 01-1.48 2.71 7.616 7.616 0 01-4.16 1 5.997 5.997 0 01-3.09-.67 2.15 2.15 0 01-1.09-2c0-1.13.7-1.87 2.11-2.2a1.946 1.946 0 01-.76-.59 1.373 1.373 0 01-.32-.82c-.004-.279.08-.552.24-.78a3.407 3.407 0 011-.81 2.52 2.52 0 01-1.16-1 3.122 3.122 0 01-.43-1.69 2.911 2.911 0 011.06-2.41 4.683 4.683 0 013-.86c.18 0 .47 0 .9.06.43.06.74.08.94.11zm-7.17 10.7a.73.73 0 00.43.65c.363.18.765.266 1.17.25a5.01 5.01 0 001.91-.3c.48-.2.72-.46.72-.77a.55.55 0 00-.44-.53 3.722 3.722 0 00-1.25-.16h-1.25a1.542 1.542 0 00-.9.25.718.718 0 00-.36.6zm1-7.59c0 .98.333 1.47 1 1.47a.821.821 0 00.72-.37c.194-.325.285-.702.26-1.08 0-1-.33-1.48-1-1.48-.67 0-.92.48-.92 1.45zM69.33 38.5l-.83-.85c-.392.259-.807.48-1.24.66a5.605 5.605 0 01-1.09.27 9.237 9.237 0 01-1.37.09 5.793 5.793 0 01-2.35-.45A3.54 3.54 0 0160.89 37a3.285 3.285 0 01-.54-1.86 3.65 3.65 0 012.28-3.36 5.145 5.145 0 01-.81-1.25 3.734 3.734 0 01-.29-1.53 2.531 2.531 0 011-2.13 4.569 4.569 0 012.85-.79 4.357 4.357 0 012.76.78 2.599 2.599 0 011 2.14 2.996 2.996 0 01-.54 1.73 5.334 5.334 0 01-1.6 1.48l1.67 1.58a6.084 6.084 0 00.87-2.18h3.36c-.173.801-.438 1.58-.79 2.32a9.56 9.56 0 01-1.22 2l2.68 2.57zm-5.6-3.64a1.1 1.1 0 00.38.86 1.43 1.43 0 001 .34c.286.007.57-.037.84-.13.201-.062.39-.157.56-.28l-2.09-2.12c-.438.3-.696.799-.69 1.33zM66.21 29a.691.691 0 00-.21-.6.998.998 0 00-.6-.18.995.995 0 00-.62.21.82.82 0 00-.26.67c.054.518.322.989.74 1.3a2.1 2.1 0 00.73-.64c.148-.226.224-.49.22-.76zM92.31 38.5h-3.92l-1.18-5.35c0-.22-.14-.66-.26-1.33s-.21-1.22-.26-1.67c0 .36-.12.81-.22 1.35s-.2 1-.3 1.49c-.1.49-.51 2.29-1.17 5.51h-4l-3-12.27h3.2l1.33 6.15c.3 1.36.51 2.45.62 3.25.08-.57.21-1.34.39-2.32.18-.98.37-1.8.53-2.44l1.08-4.64h3.07l1.05 4.64c.18.75.36 1.6.55 2.58.19.98.31 1.7.37 2.18.07-.62.27-1.7.59-3.23l1.36-6.17h3.2zM100.55 38.67a5.131 5.131 0 01-3.69-1.26 4.793 4.793 0 01-1.31-3.6 5.19 5.19 0 011.22-3.7 4.54 4.54 0 013.47-1.29 4.628 4.628 0 013.32 1.12 4.238 4.238 0 011.18 3.23v1.46h-5.87a1.6 1.6 0 00.58 1.25c.429.328.961.491 1.5.46a7.143 7.143 0 001.59-.17 7.474 7.474 0 001.57-.56V38a5.467 5.467 0 01-1.59.55c-.652.098-1.311.138-1.97.12zm-.19-7.61a1.37 1.37 0 00-1 .36 1.75 1.75 0 00-.46 1.15h2.82a1.621 1.621 0 00-.39-1.1 1.249 1.249 0 00-.97-.41zM109.76 38.5h-3.28V25.44h3.28zM119.08 38.5h-7.88v-1.87l3.94-5.13h-3.71V29h7.47v2l-3.77 5h4zM120.46 26.62a1.371 1.371 0 01.42-1.1 2.002 2.002 0 011.32-.36c.477-.041.952.09 1.34.37.294.283.448.682.42 1.09 0 1-.59 1.45-1.76 1.45s-1.74-.49-1.74-1.45zm3.37 11.88h-3.28V29h3.28zM125.77 42.63a8.507 8.507 0 01-.93-.06 5.088 5.088 0 01-.83-.15v-2.56a3.68 3.68 0 001 .15c.67 0 1-.47 1-1.42V29h3.28v10.28a3.289 3.289 0 01-.91 2.46 3.59 3.59 0 01-2.61.89zm.16-16a1.37 1.37 0 01.41-1.1 2 2 0 011.33-.36c.473-.038.945.093 1.33.37.294.283.448.682.42 1.09 0 1-.58 1.45-1.75 1.45s-1.74-.5-1.74-1.46zM137.64 38.5v-5.19a2.995 2.995 0 00-.27-1.43.93.93 0 00-.88-.48 1.282 1.282 0 00-1.2.66 5.14 5.14 0 00-.37 2.28v4.16h-3.28V29h2.48l.41 1.18h.19a2.587 2.587 0 011.16-1 3.992 3.992 0 011.71-.34 3.267 3.267 0 012.46.92c.619.708.935 1.631.88 2.57v6.17z"/>
    </g>
  </svg>
  `);
    }
    connectedCallback() {
        this.defaultStyling = {
            width: 1200,
            height: 1200,
            data: this.url,
            // margin: 10,
            qrOptions: {
                mode: "Byte",
                errorCorrectionLevel: "H",
            },
            imageOptions: {
                hideBackgroundDots: false,
                imageSize: 1,
                margin: 0,
            },
            dotsOptions: {
                type: "square",
                color: "#393a3c",
            },
            backgroundOptions: {
                color: "#ffffff",
            },
            // image: this.logo,
            cornersSquareOptions: {
                type: "extra-rounded",
                color: "#404b96",
            },
            cornersDotOptions: {
                type: "square",
            },
        };
        const template = this.templateFromString(`
      <style>${css}</style>
      <div class="root"></div>`, true);
        this.shadowRoot.appendChild(template);
        const rootElement = this.shadowRoot.querySelector(".root");
        this.createProjector(rootElement, this.render);
    }
    static get observedAttributes() {
        return ["data"];
    }
}
customElements.define("pfzw-qr-code-generator", PfzwQrCodeGenerator);
// let greetInputEl: HTMLInputElement | null;
// let greetMsgEl: HTMLElement | null;
// async function greet() {
//   if (greetMsgEl && greetInputEl) {
//     // Learn more about Tauri commands at https://tauri.app/v1/guides/features/command
//     greetMsgEl.textContent = await invoke("greet", {
//       name: greetInputEl.value,
//     });
//   }
// }
// window.addEventListener("DOMContentLoaded", () => {
//   greetInputEl = document.querySelector("#greet-input");
//   greetMsgEl = document.querySelector("#greet-msg");
//   document
//     .querySelector("#greet-button")
//     ?.addEventListener("click", () => greet());
// });
